<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Manager">
	<select id="EmpMainList" parameterType="int" resultType="com.es.manager.EmpListDto">
		select e.emp_no emp_no, e.name name, d.dept_name dept_name, p.position_name position_name
		from employees e, department d, position p
		where e.dept_no = d.dept_no and e.position_no = p.position_no
		order by e.emp_no asc
		limit #{start}, 10
	</select>
	<select id="InstMainList" parameterType="int" resultType="com.es.manager.InstListDto">
		select emp_no, instructor_no, name
		from Instructor
		order by instructor_no asc
		limit #{start}, 10
	</select>
	<select id="EmpSearchList" parameterType="hashmap" resultType="com.es.manager.EmpListDto">
		select e.emp_no emp_no, e.name name, d.dept_name dept_name, p.position_name position_name
		from employees e, department d, position p
		where e.dept_no = d.dept_no and e.position_no = p.position_no and
		<if test='dept != "nothing"'>
			e.dept_no = #{dept} and
		</if>
		<if test='pos != "nothing"'>
			e.position_no = #{pos} and
		</if>
		<choose>
			<when test='cat == "number"'>
				e.emp_no like concat('%', #{word}, '%')
			</when>
			<when test='cat == "name"'>
				e.name like concat('%', #{word}, '%')
			</when>
		</choose>
		order by e.emp_no asc
		limit #{start}, 10
	</select>
	<select id="InstSearchList" parameterType="hashmap" resultType="com.es.manager.InstListDto">
		select emp_no, instructor_no, name from instructor where
		<choose>
			<when test="type == 'internal'">
				emp_no is not null and
			</when>
			<when test="type == 'external'">
				emp_no is null and
			</when>
		</choose>
		<choose>
			<when test="cat == 'number'">
				instructor_no like concat('%', #{word}, '%')
			</when>
			<when test="cat == 'name'">
				name like concat('%', #{word}, '%')
			</when>
		</choose>
		order by instructor_no asc
		limit #{start}, 10
	</select>
	
	<select id="EmpDetail" parameterType="String" resultType="com.es.manager.EmpListDto">
		SELECT 	e.emp_no emp_no, e.name name, d.dept_name dept_name,
				p.position_name position_name
		FROM 	employees e, department d, position p
		WHERE 	e.dept_no = d.dept_no
		AND		e.position_no = p.position_no
		AND 	e.emp_no = #{emp_no}
	</select>
</mapper>